<div class="action-page">
	<div class="avatar">
	</div>
	<div class="action-options">
		<div class="action-option" id="acop-1">
			<a id="download-image-link">
				<%= image_tag("acop1.png", alt: "Action 1", id:"acop1") %>
			</a>	
		</div>
		<div class="action-option" id="acop-2">
			<%= image_tag("acop2.png", alt: "Action 2", id:"acop2") %>
		</div>
		<div class="action-option" id="acop-3">
			<%= image_tag("acop3.png", alt: "Action 3", id:"acop3") %>
		</div>
		<div class="action-option" id="acop-4">
			<%= image_tag("acop4.png", alt: "Action 4", id:"acop4") %>
		</div>
	</div>
</div>

<script type="text/javascript">

var avatarImg = localStorage["avatar"];
var blob;

try {
        blob = dataURItoBlob(avatarImg);
    } catch (e) {
        console.log(e);
    }

// Convert a data URI to blob
function dataURItoBlob(dataURI) {
    var byteString = atob(dataURI.split(',')[1]);
    var ab = new ArrayBuffer(byteString.length);
    var ia = new Uint8Array(ab);
    for (var i = 0; i < byteString.length; i++) {
        ia[i] = byteString.charCodeAt(i);
    }
    return new Blob([ab], {
        type: 'image/png'
    });
}

var imgURL = "http://myntra.myntassets.com/images/style/properties/Adidas-Men-Grey-Energy-Boost-2-M-Sports-Shoes_a364c3b7f36216e2d583b6174ddd8c58_images_360_480_mini.jpg";
$(".avatar").append("<img src='"+avatarImg+"' id='avatar-image'/>");
$("#download-image-link").prop("href",avatarImg);
$("#download-image-link").prop("download","holi-avatar.png");
$(".action-option").click(function(){
	var choice = $(this).attr("id").split("-")[1];
	if(choice==2){
		var albumID;
		 FB.api('/me/albums/?fields=name', function(response) {
		 	if(response && !response.error){
		 	var albumArr = response["data"];
		 	for(var i=0; i<albumArr.length; i++){
		 		if(albumArr[i]["name"]=="Timeline Photos"){
		 			albumID=albumArr[i]["id"];
		 			break;
		 		}
		 	}
		 	
		 	FB.api('/'+albumID+'/photos', 'post', {
	        message:'Happy Holi from Tangerine!',
	        source:blob        
		    }, function(response){
		        if (!response || response.error) {
		            alert('Error occured'+JSON.stringify(response.error))	;
		        } else {
		            alert('Post ID: ' + response.id);
		        }
		    });
		 }
		 else{
		 	alert(JSON.stringify(response.error));
		 }
	});
	}
	if(choice==4){
		     var opts = {
                message : "hey",
                name : 'Name',
                link : 'www.kuliza.com',
                description : 'post description',
                picture : avatarImg
            };
 
            FB.api('/me/feed', 'post', opts, function(response)
            {
                if (!response || response.error)
                {
                    alert('Posting error occured'+JSON.stringify(response.error));
                }
                else
                {
                    alert('Success - Post ID: ' + response.id);
                }
            });
	}
	if(choice==3){
		FB.ui({method: 'apprequests',
		  message: 'My Great Request'
		}, function(response){
			if (!response || response.error)
                {
                    alert('ERROR'+JSON.stringify(response.error));
                }
                else
                {
                    alert('Success'+JSON.stringify(response));
                }
		});
	}
});
</script>
